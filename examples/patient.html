<html>
<body>
<script src="../index.js"></script>

Rule base adapted from: http://www.csis.ysu.edu/~john/824/examples/EMH1.txt

<script id="rulebase">

var not = RuleReactor.not;
var assert = RuleReactor.assert;

function Patient() { 
	this.diagnosis = null;
	this.treatment = null;
}
 
// These classes represent conclusions which we may assign
// values to as a result of the inference.

function Diagnosis(name,reason) {
	this.name = name;
	this.reason = reason;
 }
function Treatment(name) { 
	this.name = name;
}


// In its simplest form, a rule just boolean condition function which is a
// "template" that the inference engine will try to match to some
// fact. And a function to execute if the condition is true. In this case, 
// it matches a Patient with specific values for fever, spots, and innoculated 
// (the other values don't matter). In this case, we modify the matching Patient
// to have the diagnosis measles.
RuleReactor.createRule("Measles",0,{p: Patient},
	function(p1) {
		return p1.fever==="high" && p1.spots===true && p1.innoculated===false;
	},
	function(p1) {
		p1.diagnosis = new Diagnosis("measles","High temp, spots, and no innoculation for measles.");
	});

// of course, there are lots of other things that could be wrong
RuleReactor.createRule("Allergy1",0,{p: Patient},
	function(p1) {
		return p1.spots===true && (p1.fever!=="high" || p1.innoculated===true);
	},
	function(p1) {
		p1.diagnosis = new Diagnosis("allergy","Allergy diagnosed from presence of spots and no fever or is innoculated for measles.");
	});

RuleReactor.createRule("Allergy2",0,{p: Patient},
	function(p1) {
		return p1.rash===true;
	},
	function(p1) {
		p1.diagnosis = new Diagnosis("allergy","Allergy diagnosed from presence of rash.");
	});

RuleReactor.createRule("Flu",0,{p: Patient},
	function(p1) {
		return p1.soreThroat===true && (p1.fever==="mild" || p1.fever==="high");
	},
	function(p1) {
		p1.diagnosis = new Diagnosis("flu","Flue diagnosed from sore throat and mild to high fever.");
	});

// Rules for recommending treatments on the basis of Diagnosis

RuleReactor.createRule("Penicillin",0,{p: Patient, d: Diagnosis},
	function(p,d) {
		return d && d.name==="measles";
	},
	function(p) {
		p.treatment = new Treatment("pennicillin");
	});

RuleReactor.createRule("Allergy Pills",0,{p: Patient, d: Diagnosis},
	function(p,d) {
		return d && d.name==="allergy";
	},
	function(p) {
		p.treatment = new Treatment("allergy pills");
	});
	
RuleReactor.createRule("Bed Rest",0,{p: Patient, d: Diagnosis},
	function(p,d) {
		return d && d.name==="flu";
	},
	function(p) {
		p.treatment = new Treatment("bed rest");
	});


// data matched by the rules is just JavaScript class instances asserted into the RuleReactor

RuleReactor.trace();
var p = new Patient();
p.fever = "low";
p.spots = true;
p.rash = false;
p.soreThroat = false;
p.innoculated = false;
RuleReactor.assert(p);


</script>
</body></html>