!function e(n,t,r){function i(c,a){if(!t[c]){if(!n[c]){var u="function"==typeof require&&require
if(!a&&u)return u(c,!0)
if(o)return o(c,!0)
var s=new Error("Cannot find module '"+c+"'")
throw s.code="MODULE_NOT_FOUND",s}var f=t[c]={exports:{}}
n[c][0].call(f.exports,function(e){var t=n[c][1][e]
return i(t?t:e)},f,f.exports,e,n,t,r)}return t[c].exports}for(var o="function"==typeof require&&require,c=0;c<r.length;c++)i(r[c])
return i}({1:[function(e,n,t){(function(){"use strict"
function e(n){var t=arguments.length
if(0===t)return[]
if(1===t)return e(n,n)
var r=0,i=0,o=0,c=[],a=[],u=new Map
do{var s=arguments[r],f=s.length,l=1<<r,p=0
if(!f)return[]
i|=l
do{var d=s[p],v=u.get(d)
void 0===v?(o++,v=a.length,u.set(d,v),c[v]=d?d.valueOf():d):a[v]|=l}while(++p<f)}while(++r<t)
var g=[],p=0
do a[p]===i&&(g[g.length]=c[p])
while(++p<o)
return g}function n(e){this.collections=e?e:[],Object.defineProperty(this,"length",{set:function(){},get:function(){var e=1
return this.collections.forEach(function(n){e*=n.length}),e}}),Object.defineProperty(this,"size",{set:function(){},get:function(){return this.length}})}function t(e,n,t,r){for(var i=n.length;i--;)r[i]=n[i][(e/t[i][0]<<0)%t[i][1]]}function r(e,n,t,i,o,c,a,u){var s=t[e],f=t.length-1,l=i[e]
if(e==f)for(var p=0;l>p;++p)o[e]=s[p],(!u||u(o))&&c(o.slice(0),n.count),n.count++
else for(var p=0;l>p;++p)o[e]=s[p],r(e+1,n,t,i,o,c,a,u)
o.pop()}function i(e){var n=e+"",t=n.indexOf("(")+1,r=n.indexOf(")"),i=n.substring(t,r).split(",")
return i.forEach(function(e,n){i[n]=e.trim()}),i}function o(e){var n=Object.keys(e.domain),t={}
n.forEach(function(e){t[e]||(t[e]=0),t[e]++}),n.forEach(function(t){var r=e.domain[t]
r.prototype.rules=r.prototype.rules?r.prototype.rules:{},r.prototype.rules[e.name]=e,r.prototype.activeKeys=r.prototype.activeKeys?r.prototype.activeKeys:{},r.exists=function(e){return e=e?e:function(){return!0},r.instances&&r.instances.some(function(n){return e(n)})},r.forall=function(e){return r.instances&&r.instances.every(function(n){return e(n)})},e.range[t]={},e.bindings[t]=e.bindings[t]?e.bindings[t]:[],e.conditions.forEach(function(o){if(!o.required){var c=i(o)
o.required=new Array(c.length),c.forEach(function(e,t){o.required[t]=n.indexOf(e)})}o.range=o.range?o.range:{},o.range[t]={},(o+"").replace(new RegExp("(\\b"+t+"\\.\\w+\\b)","g"),function(n){var i=n.split("."),c=i[1]
return r.prototype.activeKeys[c]=!0,e.range[t][c]=e.range[t][c]?e.range[t][c]:!0,o.range[t][c]=o.range[t][c]?o.range[t][c]:!0,n})})
var o=i(e.action)
o.indexOf(t)>=0&&(e.action.domain=e.action.domain?e.action.domain:{},e.action.domain[t]=!0)}),e.compiledConditions=[],e.conditions.forEach(function(n,t){e.compiledConditions.push(function(e){var t=this,r=[]
return n.required.every(function(n){return void 0!==e[n]?r.push(e[n]):void 0})?n.apply(t,r):!0})})}function c(e,n,t,r,i){var o=this
o.rule=e,o.match=n,o.index=t,o.bindings=r,o.instance=i,u.agenda.some(function(e,n){return e.rule.salience<=o.rule.salience?(u.agenda.splice(n,0,o),!0):void 0})||u.agenda.push(o)
var c=e.activations.get(i)
c||(c=[],e.activations.set(i,[])),c.push(o),u.tracelevel>1&&s.log("Activating: ",e,n)}function a(e,n,t,r,i){this.name=e,this.salience=n,this.domain=t,this.range={},this.conditions=Array.isArray(r)||r instanceof Array?r:[r],this.pattern=new Array(Object.keys(t).length),this.action=i,this.bindings={},this.activations=new Map,this.options={optimize:"stack"},o(this),u.tracelevel>2&&s.log("New Rule: ",this)}var u={}
n.prototype.add=function(e){var n=this
return n.fixed||e.forEach(function(e){n.collections.push(e)}),n},n.prototype.get=function(e,n){for(var r,i=this,o=[],c=[],a=1,u=i.collections.length;u--;a*=r)c[u]=[a,r=i.collections[u].length]
return e>=i.length?void 0:(t(e,i.collections,c,o),!n||n.every(function(e,n){return void 0===e||("function"==typeof e?e.call(o,o[n],n):!1)||o[n]===e})?o.slice(0):void 0)},n.prototype.indexOf=function(e){for(var n,t=this,r=0,i=[],o=1,c=t.collections.length;c--;o*=n)i[c]=o,n=t.collections[c].length
return t.collections.every(function(n,t){var o=n.indexOf(e[t])
return o>=0?(r+=o*i[t],!1):!1})?r:-1},n.prototype.intersection=function(t){var r=this,i=[]
return r.collections.length!==t.collections.length?new n([]):(r.collections.forEach(function(n,r){i.push(e(n,t.collections[r]))}),new n(i))},n.prototype.push=function(e,n){return me.fixed||this.collections[e].push(n),this},n.prototype.verify=function(e,n){var t=this,r=t.get(e)
return r&&r.every(function(e,t){return e===n[t]})},n.prototype.forEach1=function(e,n,t){for(var i=this,o=[],c=[],a=i.collections.length;a--;)c[a]=i.collections[a].length
r(0,{count:0},i.collections,c,o,e,n,t)},n.prototype.forEach2=function(e,n,t){var r=this,i=0
do{if(!r.deleted[i]){var o=r.get(i)
void 0!==o&&e(o)}i++}while(void 0!==o)},n.prototype.forEach=n.prototype.forEach1
var s={}
s.log=function(){console.log.apply(console,arguments)},c.prototype.execute=function(){var e=this
e.bindings.verify(e.index,e.match)&&e.rule.compiledConditions.every(function(n){return n.call(e,e.match)})&&(u.tracelevel>0&&s.log("Firing: ",this.rule,this.match),e.rule.fire(e.match)),e["delete"]()},c.prototype["delete"]=function(e){var n=this
if(!e||n.match.indexOf(e)>=0){u.tracelevel>1&&s.log("Deactivating: ",n.rule,n.match)
var t=n.rule.activations.get(n.instance)
if(t){var r=t.indexOf(n)
r>=0&&t.splice(r,1)}var r=u.agenda.indexOf(n)
r>=0&&u.agenda.splice(r,1)}},a.prototype.bind=function(e,t){var r=this,i=Object.keys(r.bindings),o=[]
i.map(function(n){e instanceof r.domain[n]&&-1===r.bindings[n].indexOf(e.__rrid__)&&(u.tracelevel>2&&s.log("Binding: ",r,n,e),r.bindings[n].push(e))}),i.every(function(e,n){return o.push(r.bindings[e]),r.bindings[e].length>0})&&(r.cxproduct||(r.cxproduct=(new n).add(o)),t&&r.test(e))},a.prototype.fire=function(e){var n=this,t=Object.keys(n.domain),r=[]
Object.keys(n.action.domain).forEach(function(n){r.push(e[t.indexOf(n)])}),n.action.apply(n,r)},a.prototype.setOptions=function(e){var n=this
Object.keys(e).forEach(function(t){n.options[t]=e[t]})},a.prototype.test=function(e,t,r){var i=this,o=Object.keys(i.domain),a=!1,f=[]
if(!o.every(function(e){return f.push(i.bindings[e]),i.bindings[e].length>0}))return a
u.tracelevel>2&&s.log("Testing: ",i,e,t)
var l=function(e){return i.compiledConditions.every(function(n){return n.call(i,e)})}
return e?o.forEach(function(t,r){var o=i.cxproduct.collections.slice(0)
if(e instanceof i.domain[t]){o[r]=[e]
var u=new n(o)
u.forEach(function(e,n){new c(i,e,n,u),a=!0},void 0,l)}}):i.cxproduct.forEach(function(e,n){new c(i,e,n,i.cxproduct),a=!0},void 0,l),r?void r(null,a):a},a.prototype.reset=function(e,n){var t=this
u.tracelevel>2&&s.log("Reseting: ",t,n),t.activations.forEach(function(e,t){n&&t!==n||e.forEach(function(e){var n=u.agenda.indexOf(e)
n>=0&&u.agenda.splice(n,1)})}),e&&t.test(n)},a.prototype.unbind=function(e){var n=this,t=Object.keys(n.bindings)
t.map(function(t){var r=n.bindings[t].indexOf(e)
r>=0&&(u.tracelevel>2&&s.log("Unbinding: ",n,t,e),n.bindings[t].splice(r,1),0===n.bindings[t].length?(n.cxproduct=null,n.reset(!1)):n.reset(!1,e))})},u.rules={},u.data=[],new Map,u.agenda=[],u.createRule=function(e,n,t,r,i){var o=new a(e,n,t,r,i)
return u.rules[o.name]=o,o},u.get=function(e){return"number"==typeof e?u.data[e]:u.data[u.data.indexOf(e)]},u.insert=function(e,n){e=Array.isArray(e)||e instanceof Array?e:[e]
var t=[]
e.forEach(function(e){if(e&&"object"==typeof e&&void 0===e.__rrid__){u.tracelevel>2&&s.log("Insert: ",e),Object.defineProperty(e,"__rrid__",{value:u.data.length}),u.data.push(e),t.push(e),e.constructor.instances=e.constructor.instances?e.constructor.instances:[],e.constructor.instances.push(e)
var n=Object.keys(e)
e.activeKeys&&Object.keys(e.activeKeys).forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n.forEach(function(n){function t(){return t.value}function r(r){return t.value!==r?(u.tracelevel>2&&s.log("Modify: ",e,n,t.value,"=>",r),t.value=r,r&&r.rules&&u.insert(r),Object.keys(e.rules).forEach(function(t){var r=e.rules[t]
if(Object.keys(r.range).some(function(t){return r.range[t][n]&&e instanceof r.domain[t]})){var i=r.activations.get(e)
i&&i.forEach(function(e){e["delete"]()}),r.test(e,n)}}),t.value):void 0}var i,o=Object.getOwnPropertyDescriptor(e,n)
if(o&&(i={},Object.keys(o).forEach(function(e){i[e]=o[e]})),o=o?o:{enumerable:!0,configurable:!1},!o.get||"rrget"!==o.get.name){if(t.value=o.value,t.originalDescriptor=i,o.value instanceof Array||Array.isArray(o.value)){var c=o.value
i.value=c.slice()
var a=["push","pop","splice","shift","unshift"]
a.forEach(function(r){var i=c[r]
if("function"==typeof i){var o=function(){i.apply(c,arguments),Object.keys(e.rules).forEach(function(t){var r=e.rules[t]
if(Object.keys(r.range).some(function(t){return r.range[t][n]&&e instanceof r.domain[t]})){var i=r.activations.get(e)
i&&i.forEach(function(e){e["delete"]()}),r.test(e,n)}})}
Object.defineProperty(t.value,r,{configurable:!0,writable:!0,value:o})}}),Object.getOwnPropertyNames(Array.prototype).forEach(function(e){var n=c[e]
"function"==typeof n&&-1===a.indexOf(e)&&Object.defineProperty(t.value,e,{configurable:!0,writable:!0,value:function(){return n.apply(c,arguments)}})})}delete o.value,delete o.writable,o.get=t,o.set=r,Object.defineProperty(e,n,o)}})}}),t.forEach(function(e){e.rules&&Object.keys(e.rules).forEach(function(n){e.rules[n].bind(e)})})
var r={}
t.forEach(function(e){e.rules&&Object.keys(e.rules).forEach(function(n){r[n]=e.rules[n]})}),Object.keys(r).forEach(function(e){r[e].test()}),n&&n(null)},u.not=function(e){return!e},u.remove=function(){var e=e=arguments[arguments.length-1]instanceof Object?!1:arguments[arguments.length-1],n=[].slice.call(arguments)
n.forEach(function(e){e&&"object"==typeof e&&(u.tracelevel>2&&s.log("Remove: ",e),u.data["delete"](e),Object.keys(e).forEach(function(n){var t=Object.getOwnPropertyDescriptor(e,n)
if("rrget"===t.get.name)if("undefined"==typeof t.get.originalDescriptor)delete e[n]
else{if(t.get.originalDescriptor.value instanceof Array||Array.isArray(t.get.originalDescriptor.value))if(e[n]instanceof Array||Array.isArray(e[n])){var r=[0,e[n]].concat(t.get.originalDescriptor.value)
e[n].splice.apply(e[n],r)}else e[n]=t.get.originalDescriptor.value
Object.defineProperty(e,n,t.get.originalDescriptor)}}),Object.keys(e.rules).forEach(function(n){e.rules[n].unbind(e)}))}),e&&setTimeout(function(){u.run()})},u.reset=function(e){if(Object.keys(u.rules).forEach(function(e){u.rules[e].reset()}),e){var n=[]
u.data.forEach(function(e){n.push(e)}),n.push(!1),u.remove(n,!1)}},u.run=function(e,n,t){function r(e){for(;u.agenda.length>0&&u.run.executions<u.run.max;)if(u.run.executions++,u.agenda[u.agenda.length-1].execute(),e)return void setTimeout(r,0,e)
u.run.stop=new Date,u.run.rps=u.run.executions/(u.run.stop.getTime()-u.run.start.getTime())*1e3,u.run.running=!1,"function"==typeof t&&t()}return u.run.running?!0:(u.run.max=e?e:1/0,u.run.running=!0,u.run.executions=0,u.run.start=new Date,u.tracelevel>0&&s.log("Run: ",e,n),void r(n))},u.trace=function(e){u.tracelevel=e},this.exports?this.exports=u:"function"==typeof define&&define.amd?define(function(){return u}):this.RuleReactor=u}).call("undefined"!=typeof window?window:"undefined"!=typeof n?n:null)},{}]},{},[1])
