!function e(n,t,r){function i(a,s){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require
if(!s&&c)return c(a,!0)
if(o)return o(a,!0)
var u=new Error("Cannot find module '"+a+"'")
throw u.code="MODULE_NOT_FOUND",u}var f=t[a]={exports:{}}
n[a][0].call(f.exports,function(e){var t=n[a][1][e]
return i(t?t:e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a])
return i}({1:[function(e,n,t){(function(){"use strict"
function e(e,n,t){var r=[],i=Array(e.length)
return function o(a){if(a===e.length){var s=e.map(function(e,n){return e[i[n]]})
return n?n(s)?r.push(t?t(s):s):r.length:r.push(t?t(s):s)}for(var c=0;c<e[a].length;++c)i[a]=c,o(a+1)}(0),r}function n(e,n,t){var r=1,i=e.length
e.map(function(e){r*=e.length})
var o=new Array(r),a=[],s=r
return e.map(function(e){var c=e.length
s/=c
for(var u=r-1;u>=0;u--){o[u]=o[u]?o[u]:[]
var f=u/s%c
if(f=1>f||.5>=f%1?Math.floor(f):Math.min(e.length-1,Math.ceil(f)),o[u].push(e[f]),o[u].length===i){var l=n?n(o[u]):!0
l&&(t?a.push(t(o[u])):a.push(o[u]))}}}),a}function t(e){var n=e+"",t=n.indexOf("(")+1,r=n.indexOf(")"),i=n.substring(t,r).split(",")
return i.forEach(function(e,n){i[n]=e.trim()}),i}function r(e){Object.keys(e.domain).forEach(function(n){var r=e.domain[n]
r.prototype.rules=r.prototype.rules?r.prototype.rules:{},r.prototype.rules[e.name]=e,r.prototype.activeKeys=r.prototype.activeKeys?r.prototype.activeKeys:{},r.exists=function(e){return e=e?e:function(){return!0},r.instances&&r.instances.some(function(n){return e(n)})},r.forall=function(e){return r.instances&&r.instances.every(function(n){return e(n)})},e.range[n]={},e.bindings[n]=e.bindings[n]?e.bindings[n]:[],e.conditions.forEach(function(i){i.crossproducts=[]
var o=t(i)
o.indexOf(n)>=0&&(i.range=i.range?i.range:{},i.range[n]={},(i+"").replace(new RegExp("(\\b"+n+"\\.\\w+\\b)","g"),function(t){var o=t.split("."),a=o[1]
return r.prototype.activeKeys[a]=!0,e.range[n][a]=e.range[n][a]?e.range[n][a]:!0,i.range[n][a]=i.range[n][a]?i.range[n][a]:!0,t}))})
var i=t(e.action)
i.indexOf(n)>=0&&(e.action.domain=e.action.domain?e.action.domain:{},e.action.domain[n]=!0)})}function i(e,n){this.rule=e,this.bindings=n,a.tracelevel>1&&s.log("Activating: ",this.rule,this.bindings)}function o(e,n,t,i,o){this.name=e,this.salience=n,this.domain=t,this.range={},this.conditions=Array.isArray(i)||i instanceof Array?i:[i],this.tests=[],this.action=o,this.bindings={},this.activations=new Map,this.crossProducts=new Map,this.options={optimize:"stack"},r(this)}var a={},s={}
s.log=function(){console.log.apply(console,arguments)},i.prototype.execute=function(){a.tracelevel>0&&s.log("Firing: ",this.rule,this.bindings),this["delete"](),this.rule.fire(this.bindings)},i.prototype["delete"]=function(e){if(!e||this.bindings.indexOf(e)>=0){a.tracelevel>1&&s.log("Deactivating: ",this.rule,this.bindings),this.rule.activations["delete"](this)
var n=a.agenda.indexOf(this)
n>=0&&a.agenda.splice(n,1)}},o.prototype.bind=function(e){var n=this,t=Object.keys(n.bindings),r=[]
t.map(function(t){e instanceof n.domain[t]&&-1===n.bindings[t].indexOf(e)&&(a.tracelevel>2&&s.log("Binding: ",n,t,e),n.bindings[t].push(e)),r.push(n.bindings[t])}),n.test(e)},o.prototype.fire=function(e){var n=this,t=Object.keys(n.domain),r=[]
Object.keys(n.action.domain).forEach(function(n){r.push(e[t.indexOf(n)])}),n.action.apply(n,r)},o.prototype.setOptions=function(e){var n=this
Object.keys(e).forEach(function(t){n.options[t]=e[t]})},o.prototype.test=function(t,r){var o,c=this,u=n
return"heap"===c.options.optimize?u=e:"stack"===c.options.optimize&&(u=n),c.conditions.every(function(e,n){var i=Object.keys(e.range),f=[]
return i.some(function(n){return(!r||e.range[n][r])&&f.push(c.bindings[n]),f.length===e.length}),f.length<e.length?o?(o=e.crossproducts.filter(function(e){return o.some(function(n){return e.every(function(e,t){return n[t]===e})})}),o.length>0):!1:i.every(function(e){return c.bindings[e].length>0})?(o=u(f,function(r){return r.indexOf(t)>=0&&e.apply(c,r)&&(!o||o.some(function(e){return e.every(function(e,n){return r[n]===e})}))?(a.tracelevel>2&&s.log("Join: ",c,n,r.length,r),!0):void 0}),o.length>0?(e.crossproducts=o,!0):!1):!1})?(o&&o.forEach(function(e){var n=new i(c,e)
a.agenda.push(n),c.activations.set(e,n)}),!0):void 0},o.prototype.reset=function(e,n,t){var r,i=this,o=Object.keys(i.bindings)
n&&t&&!o.some(function(e){return n instanceof i.domain[e]&&i.range[e][t]})||(n?o.map(function(e){if(n instanceof i.domain[e]){var t=i.crossProducts.get(e)
t&&t.forEach(function(e){if(e.indexOf(n)>=0){var t=i.activations.get(e)
t&&t["delete"]()}})}}):i.crossProducts.forEach(function(e){e.forEach(function(e){r=i.activations.get(e),r&&r.forEach(function(e){e["delete"]()})})}),e&&i.test(n))},o.prototype.unbind=function(e){var n=this,t=Object.keys(n.bindings)
t.map(function(t){if(e instanceof n.domain[t]){var r=n.crossProducts.get(t)
if(r)for(var i=r.length-1;i>=0;i--)if(r[i].indexOf(e)>=0){var o=n.activations.get(r[i])
a.tracelevel>2&&s.log("Unjoin: ",n,r[i]),r.splice(i,1),o&&o["delete"]()}}}),t.map(function(t){var r=n.bindings[t].indexOf(e)
r>=0&&(a.tracelevel>2&&s.log("Unbinding: ",n,t,e),n.bindings[t].splice(r,1))})},a.rules={},a.data=new Set,a.agenda=[],a.createRule=function(e,n,t,r,i){var s=new o(e,n,t,r,i)
return a.rules[s.name]=s,s},a.insert=function(){var e=arguments[arguments.length-1]instanceof Object?!1:arguments[arguments.length-1],n=[].slice.call(arguments)
n.forEach(function(n){if(n&&"object"==typeof n&&!a.data.has(n)){a.tracelevel>2&&s.log("Insert: ",n),a.data.add(n),n.constructor.instances=n.constructor.instances?n.constructor.instances:[],n.constructor.instances.push(n)
var t=Object.keys(n)
n.activeKeys&&Object.keys(n.activeKeys).forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t.forEach(function(t){function r(){return r.value}function i(i){return r.value!==i?(r.value=i,Object.keys(n.rules).forEach(function(e){n.rules[e].test(n,t)}),i&&i.rules&&a.insert(i,e),r.value):void 0}var o,s=Object.getOwnPropertyDescriptor(n,t)
if(s&&(o={},Object.keys(s).forEach(function(e){o[e]=s[e]})),s=s?s:{enumerable:!0,configurable:!1},!s.get||"rrget"!==s.get.name){if(r.value=s.value,r.originalDescriptor=o,s.value instanceof Array||Array.isArray(s.value)){var c=s.value
o.value=c.slice()
var u=["push","pop","splice","shift","unshift"]
u.forEach(function(e){var i=c[e]
if("function"==typeof i){var o=function(){i.apply(c,arguments),Object.keys(n.rules).forEach(function(e){n.rules[e].test(n,t)})}
Object.defineProperty(r.value,e,{configurable:!0,writable:!0,value:o})}}),Object.getOwnPropertyNames(Array.prototype).forEach(function(e){var n=c[e]
"function"==typeof n&&-1===u.indexOf(e)&&Object.defineProperty(r.value,e,{configurable:!0,writable:!0,value:function(){return n.apply(c,arguments)}})})}delete s.value,delete s.writable,s.get=r,s.set=i,Object.defineProperty(n,t,s)}}),n.rules&&Object.keys(n.rules).forEach(function(e){n.rules[e].bind(n)})}}),e&&setTimeout(function(){a.run()})},a.not=function(e){return!e},a.remove=function(){var e=e=arguments[arguments.length-1]instanceof Object?!1:arguments[arguments.length-1],n=[].slice.call(arguments)
n.forEach(function(e){e&&"object"==typeof e&&(a.tracelevel>2&&s.log("Remove: ",e),a.data["delete"](e),Object.keys(e).forEach(function(n){var t=Object.getOwnPropertyDescriptor(e,n)
if("rrget"===t.get.name)if("undefined"==typeof t.get.originalDescriptor)delete e[n]
else{if(t.get.originalDescriptor.value instanceof Array||Array.isArray(t.get.originalDescriptor.value))if(e[n]instanceof Array||Array.isArray(e[n])){var r=[0,e[n]].concat(t.get.originalDescriptor.value)
e[n].splice.apply(e[n],r)}else e[n]=t.get.originalDescriptor.value
Object.defineProperty(e,n,t.get.originalDescriptor)}}),Object.keys(e.rules).forEach(function(n){e.rules[n].unbind(e)}))}),n.forEach(function(e){e&&"object"==typeof e&&e.rules&&Object.keys(e.rules).forEach(function(n){e.rules[n].test(e)})}),e&&setTimeout(function(){a.run()})},a.reset=function(e){if(Object.keys(a.rules).forEach(function(e){a.rules[e].reset()}),e){var n=[]
a.data.forEach(function(e){n.push(e)}),n.push(!1),a.remove(!1)}},a.run=function(e,n,t){function r(n){for(;a.agenda.length>0&&a.run.executions<e;)if(a.run.executions++,a.agenda[a.agenda.length-1].execute(),n)return void setTimeout(function(){r(n)})
a.run.stop=new Date,a.run.rps=a.run.executions/(a.run.stop.getTime()-a.run.start.getTime())*1e3,a.run.running=!1,"function"==typeof t&&t()}return e=e?e:1/0,a.run.running?!0:(a.run.running=!0,a.run.executions=0,a.run.start=new Date,void r(n))},a.trace=function(e){a.tracelevel=e},this.exports?this.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):this.RuleReactor=a}).call("undefined"!=typeof window?window:"undefined"!=typeof n?n:null)},{}]},{},[1])
