!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require
if(!s&&c)return c(a,!0)
if(o)return o(a,!0)
var u=new Error("Cannot find module '"+a+"'")
throw u.code="MODULE_NOT_FOUND",u}var f=n[a]={exports:{}}
t[a][0].call(f.exports,function(e){var n=t[a][1][e]
return i(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a])
return i}({1:[function(e,t,n){(function(){"use strict"
function e(e,t,n){var r=1,i=e.length
e.map(function(e){r*=e.length})
var o=new Array(r),a=[],s=r
return e.map(function(e){var c=e.length
s/=c
for(var u=r-1;u>=0;u--){o[u]=o[u]?o[u]:[]
var f=u/s%c
if(f=1>f||.5>=f%1?Math.floor(f):Math.min(e.length-1,Math.ceil(f)),o[u].push(e[f]),o[u].length===i){var l=t?t(o[u]):!0
l&&(n?a.push(n(o[u])):a.push(o[u]))}}}),a}function t(e){Object.keys(e.domain).forEach(function(t){var n=e.domain[t]
n.prototype.rules=n.prototype.rules?n.prototype.rules:{},n.prototype.rules[e.name]=e,n.prototype.activeKeys=n.prototype.activeKeys?n.prototype.activeKeys:{},n.exists=function(e){return e=e?e:function(){return!0},n.instances&&n.instances.some(function(t){return e(t)})},n.forall=function(e){return n.instances&&n.instances.every(function(t){return e(t)})},e.range[t]={},e.bindings[t]=e.bindings[t]?e.bindings[t]:[]
var r=e.condition+""
r.replace(new RegExp("(\\b"+t+"\\.\\w+\\b)","g"),function(r){var i=r.split("."),o=i[1]
return n.prototype.activeKeys[o]=!0,e.range[t][o]=e.range[t][o]?e.range[t][o]:!0,r})})}function n(e,t){this.rule=e,this.bindings=t,i.tracelevel>1&&a.log("Activating: ",this.rule,this.bindings)}function r(e,n,r,i,o){this.name=e,this.salience=n,this.domain=r,this.range={},this.condition=i,this.action=o,this.bindings={},this.crossProducts=new Map,this.activations=new Map,t(this)}var i={},o=e,a={}
a.log=function(){console.log.apply(console,arguments)},n.prototype.execute=function(){i.tracelevel>0&&a.log("Firing: ",this.rule,this.bindings),this["delete"](),this.rule.action.apply(this.rule,this.bindings)},n.prototype["delete"]=function(e){if(!e||this.bindings.indexOf(e)>=0){i.tracelevel>1&&a.log("Deactivating: ",this.rule,this.bindings),this.rule.activations["delete"](this)
var t=i.agenda.indexOf(this)
t>=0&&i.agenda.splice(t,1)}},r.prototype.bind=function(e){var t=this,n=Object.keys(t.bindings),r=[]
if(n.map(function(n){e instanceof t.domain[n]&&t.bindings[n].push(e),r.push(t.bindings[n])}),n.every(function(e){return t.bindings[e]&&t.bindings[e].length>0})){var s=o(r,function(t){return t.indexOf(e)>=0},function(e){return e.forEach(function(r,o){i.tracelevel>2&&a.log("Join: ",t,e)
var s=n[o],c=t.crossProducts.get(s)
c||(c=[],t.crossProducts.set(s,c)),c.push(e)}),e})
s&&t.test(e)}},r.prototype.unbind=function(e){var t=this,n=Object.keys(t.bindings)
n.map(function(n){if(e instanceof t.domain[n]){var r=t.crossProducts.get(n)
if(r)for(var o=r.length-1;o>=0;o--)if(r[o].indexOf(e)>=0){var s=t.activations.get(r[o])
i.tracelevel>2&&a.log("Unjoin: ",t,r[o]),r.splice(o,1),s&&s["delete"]()}}}),n.map(function(n){var r=t.bindings[n].indexOf(e)
r>=0&&t.bindings[n].splice(r,1)})},r.prototype.test=function(e,t){var r=this,o=new Map,a=Object.keys(r.bindings)
e&&t&&!a.some(function(n){return e instanceof r.domain[n]&&r.range[n][t]})||(e?a.map(function(n){if(e instanceof r.domain[n]&&(!t||r.range[n][t])){var i=r.crossProducts.get(n)
if(i){var a=[]
i.forEach(function(t){if(t.indexOf(e)>=0){a.push(t)
var n=r.activations.get(t)
n&&n["delete"]()}}),a.length>0&&o.set(n,a)}}}):r.crossProducts.forEach(function(e,t){o.set(t,e),e.forEach(function(e){var t=r.activations.get(e)
t&&t["delete"]()})}),o.forEach(function(e){e.forEach(function(e){if(r.condition.apply(r,e)){var t=new n(r,e)
i.agenda.push(t),r.activations.set(e,t)}})}))},r.prototype.reset=function(e,t,n){var r,i=this,o=Object.keys(i.bindings)
t&&n&&!o.some(function(e){return t instanceof i.domain[e]&&i.range[e][n]})||(t?o.map(function(e){if(t instanceof i.domain[e]){var n=i.crossProducts.get(e)
n&&n.forEach(function(e){if(e.indexOf(t)>=0){var n=i.activations.get(e)
n&&n["delete"]()}})}}):i.crossProducts.forEach(function(e){e.forEach(function(e){r=i.activations.get(e),r&&r.forEach(function(e){e["delete"]()})})}),e&&i.test(t))},i.rules={},i.data=new Set,i.agenda=[],i.trace=function(e){i.tracelevel=e},i.insert=function(){var e=arguments[arguments.length-1]instanceof Object?!1:arguments[arguments.length-1],t=!1,n=[].slice.call(arguments)
n.forEach(function(t){if(t&&"object"==typeof t&&!i.data.has(t)){i.tracelevel>2&&a.log("Insert: ",t),t.constructor.instances=t.constructor.instances?t.constructor.instances:[],t.constructor.instances.push(t)
var n=Object.keys(t)
t.activeKeys&&Object.keys(t.activeKeys).forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n.forEach(function(n){function r(){return r.value}function o(o){return r.value!==o?(r.value=o,Object.keys(t.rules).forEach(function(e){t.rules[e].test(t,n)}),o&&o.rules&&setTimeout(function(){i.insert(o,e)}),r.value):void 0}var a,s=Object.getOwnPropertyDescriptor(t,n)
if(s&&(a={},Object.keys(s).forEach(function(e){a[e]=s[e]})),s=s?s:{enumerable:!0,configurable:!1},!s.get||"rrget"!==s.get.name){if(r.value=s.value,r.originalDescriptor=a,s.value instanceof Array||Array.isArray(s.value)){var c=s.value
a.value=c.slice()
var u=["push","pop","splice","shift","unshift"]
u.forEach(function(e){var i=c[e]
if("function"==typeof i){var o=function(){i.apply(c,arguments),Object.keys(t.rules).forEach(function(e){t.rules[e].test(t,n)})}
Object.defineProperty(r.value,e,{configurable:!0,writable:!0,value:o})}}),Object.getOwnPropertyNames(Array.prototype).forEach(function(e){var t=c[e]
"function"==typeof t&&-1===u.indexOf(e)&&Object.defineProperty(r.value,e,{configurable:!0,writable:!0,value:function(){return t.apply(c,arguments)}})})}delete s.value,delete s.writable,s.get=r,s.set=o,Object.defineProperty(t,n,s)}}),t.rules&&Object.keys(t.rules).forEach(function(e){t.rules[e].bind(t)})}}),n.forEach(function(e){e&&"object"==typeof e&&!i.data.has(e)&&(i.data.add(e),e.rules&&(Object.keys(e.rules).forEach(function(t){e.rules[t].test(e)}),t=!0))}),e&&t&&i.run()},i.remove=function(){var e=e=arguments[arguments.length-1]instanceof Object?!1:arguments[arguments.length-1],t=!1,n=[].slice.call(arguments)
n.forEach(function(e){e&&"object"==typeof e&&(i.tracelevel>2&&a.log("Remove: ",e),i.data["delete"](e),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t)
if("rrget"===n.get.name)if("undefined"==typeof n.get.originalDescriptor)delete e[t]
else{if(n.get.originalDescriptor.value instanceof Array||Array.isArray(n.get.originalDescriptor.value))if(e[t]instanceof Array||Array.isArray(e[t])){var r=[0,e[t]].concat(n.get.originalDescriptor.value)
e[t].splice.apply(e[t],r)}else e[t]=n.get.originalDescriptor.value
Object.defineProperty(e,t,n.get.originalDescriptor)}}),Object.keys(e.rules).forEach(function(t){e.rules[t].unbind(e)}))}),n.forEach(function(e){e&&"object"==typeof e&&e.rules&&(Object.keys(e.rules).forEach(function(t){e.rules[t].test(e)}),t=!0)}),e&&t&&i.run()},i.reset=function(e){if(Object.keys(i.rules).forEach(function(e){i.rules[e].reset()}),e){var t=[]
i.data.forEach(function(e){t.push(e)}),t.push(!1),i.remove(!1)}},i.run=function(e){for(e=e?e:1/0,i.run.executions=0,i.run.start=new Date;i.agenda.length>0&&i.run.executions<e;)i.run.executions++,i.agenda[i.agenda.length-1].execute()
i.run.stop=new Date,i.run.rps=i.run.executions/(i.run.stop.getTime()-i.run.start.getTime())*1e3},i.createRule=function(e,t,n,o,a){var s=new r(e,t,n,o,a)
return i.rules[s.name]=s,s},i.not=function(e){return!e},this.exports?this.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):this.RuleReactor=i}).call("undefined"!=typeof window?window:"undefined"!=typeof t?t:null)},{}]},{},[1])
