!function e(n,t,r){function i(a,c){if(!t[a]){if(!n[a]){var u="function"==typeof require&&require;if(!c&&u)return u(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=t[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return i(t?t:e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n,t){var r=e("uuid");(function(){"use strict";function e(e){return function(){for(var n=1/0,t=0,r=e?new Set:{},i=[],o=arguments.length-1,a=0;o>=a;a++){var c=arguments[a].length;n>c&&(t=a,n=c)}for(var u=arguments[t],s=u.length,f=0;s>f;f++)e?r.add(u[f]):r[u[f]]=1;for(var a=0;o>=a;a++)for(var l=arguments[a],d=l.length,p=0;d>p;p++){var v=l[p];(e&&r.has(v)||r[v])&&a===o&&i.push(v)}return i}}function n(e){var n=this;n.collections=e?e:[]}function t(e){var n=e+"",t=n.indexOf("(")+1,r=n.indexOf(")"),i=n.substring(t,r).split(",");return i.forEach(function(e,n){i[n]=e.trim()}),1===i.length&&""===i[0]?[]:i}function i(e,n,r){var i=Object.keys(n.domain);i.forEach(function(e){var t=n.domain[e];if("function"!=typeof t)throw new TypeError("Domain variable "+e+" is not a constructor in rule "+n.name);if(!t.name||0===t.name.length||"anonymous"===t.name)throw new TypeError("Constructor for domain variable "+e+" in rule "+n.name+" must have a name.");n.reactor.domain[t.name]||(n.reactor.domain[t.name]=t),t.instances=t.instances?t.instances:[],t.index=t.index?t.index:{},t.prototype.rules=t.prototype.rules?t.prototype.rules:{},t.prototype.rules[n.name]=n,t.prototype.activeKeys=t.prototype.activeKeys?t.prototype.activeKeys:{},t.exists=function(e){return e=e?e:function(){return!0},t.instances&&t.instances.some(function(n){return e(n)})},t.forAll=function(e){return t.instances&&t.instances.every(function(n){return e(n)})},n.range[e]={},n.bindings[e]=n.bindings[e]?n.bindings[e]:[],n.conditions.forEach(function(r){(r+"").replace(new RegExp("(\\b"+e+"\\.\\w+\\b)","g"),function(r){var i=r.split("."),o=i[1];return-1===o.indexOf("(")&&(t.prototype.activeKeys[o]=!0,n.range[e][o]=!0),r})})}),i.length>0&&n.triggers.push({domain:n.domain,range:n.range}),n.conditions.forEach(function(e){(e+"").replace(/exists\(\s*(\s*{.*\s*})\s*,\s*(.*)\s*\)/g,function(e,t,r){var i=new Function("return "+t)(),o=Object.keys(i),a={domain:i,range:{}};return n.triggers.push(a),o.forEach(function(e){var t=i[e];n.reactor.domain[t.name]||(n.reactor.domain[t.name]=t),a.range[e]=a.range[e]?a.range[e]:{},t.prototype.rules=t.prototype.rules?t.prototype.rules:{},t.prototype.rules[n.name]=n,t.prototype.activeKeys=t.prototype.activeKeys?t.prototype.activeKeys:{},r.replace(new RegExp("(\\b"+e+"\\.\\w+\\b)","g"),function(n){var r=n.split("."),i=r[1];return-1===i.indexOf("(")&&(t.prototype.activeKeys[i]=!0,a.range[e][i]=!0),n})}),e}),(e+"").replace(/forAll\(\s*(\s*{.*\s*})\s*,\s*(.*)\s*\)/g,function(e,t,r){var i=new Function("return "+t)(),o=Object.keys(i),a={domain:i,range:{}};return n.triggers.push(a),o.forEach(function(e){var t=i[e];n.reactor.domain[t.name]||(n.reactor.domain[t.name]=t),a.range[e]=a.range[e]?a.range[e]:{},t.prototype.rules=t.prototype.rules?t.prototype.rules:{},t.prototype.rules[n.name]=n,t.prototype.activeKeys=t.prototype.activeKeys?t.prototype.activeKeys:{},r.replace(new RegExp("(\\b"+e+"\\.\\w+\\b)","g"),function(n){var r=n.split("."),i=r[1];return-1===i.indexOf("(")&&(t.prototype.activeKeys[i]=!0,a.range[e][i]=!0),n})}),e})}),n.compiledConditions=[],n.conditions.forEach(function(e,o){if(-1===(e+"").indexOf("return"))throw new TypeError("Condition function missing a return statereactornt in rule '"+n.name+"' condition "+o);var a=t(e);if(e.required=new Array(a.length),a.forEach(function(t,r){var a=i.indexOf(t);if(-1===a)throw new ReferenceError("Referenced domain variable '"+t+"' undefined in rule '"+n.name+"' condition ",o);e.required[r]=a}),r){var c=e.required?e.required:[],u=new Function("match","var args = [];if("+JSON.stringify(c)+".every(function(i,j,required){if(match[i]!==undefined){return args.push(match[i]);}})) {return ("+e+").apply(undefined,args);}");n.compiledConditions.push(u)}else n.compiledConditions.push(function(n){var t=this,r=[];return!e.required||e.required.every(function(e){return"undefined"!=typeof n[e]?r.push(n[e]):void 0})?e.apply(t,r):!0})});var o=t(n.action);n.action.required=new Array(o.length),o.forEach(function(e,t){var r=i.indexOf(e);if(-1===r)throw new ReferenceError("Referenced domain variable '"+e+"' undefined in rule '"+n.name+"' action");n.action.required[t]=r}),n.compiledAction=function(e){var t=this,r=[];n.action.required&&!n.action.required.every(function(n){return"undefined"!=typeof e[n]?r.push(e[n]):void 0})||n.action.apply(t,r)}}function o(e,n,t){null==t&&(t=function(e,n){return"string"!=typeof e&&(e=String(e)),"string"!=typeof n&&(n=String(n)),e>n?1:n>e?-1:0});for(var r=0,i=e.length,o=Math.floor((r+i)/2);i>r;)t(n,e[o])<0?i=o:r=o+1,o=Math.floor((r+i)/2);e.splice(o,0,n)}function a(e,n,t,r,i){var a=this;a.timestamp=new Date,a.rule=e,a.match=n,a.index=t,a.bindings=r,a.instance=i,a.rule.activated++,o(a.rule.reactor.agenda,a,function(e,n){return e.rule.salience>n.rule.salience?1:e.rule.salience<n.rule.salience?-1:0});var c=e.activations.get(i);c||(c=[]),c.push(a),e.activations.set(i,c),a.rule.reactor.tracelevel>1&&v.log("Activating: ",e,n)}function c(e,n,t,r,o,a,c){var u=this;if(u.boost=c,u.name=n,u.reactor=e,"number"!=typeof t)throw new TypeError("Salience "+t+" is not a number in rule "+n);if(u.salience=t,u.domain=r,"object"!=typeof r)throw new TypeError("Domain "+r+" is not an object in rule "+n);if(u.range={},u.triggers=[],u.conditions=Array.isArray(o)||o instanceof Array?o:[o],u.pattern=new Array(Object.keys(r).length),"function"!=typeof a)throw new TypeError("Action "+a+" is not a function in rule "+n);u.action=a,u.bindings={},u.activations=new Map,u.potentialMatches=0,u.tested=0,u.activated=0,u.fired=0,i(e,u,u.boost),u.reactor.tracelevel>2&&v.log("New Rule: ",u),u.bindInstances(!0)}function u(e,n){var t,i=!1;n instanceof Number||n instanceof String||n instanceof Boolean?(t=["value"],i=!0):t=Object.keys(n),t.forEach(function(t){e[t]=e[t]?e[t]:{};var o,a,c=i?n.valueOf():n[t],u=typeof c;"object"===u&&c?("undefined"==typeof c.__rrid__&&Object.defineProperty(c,"__rrid__",{value:r.v4()}),o=c.constructor.name+"@"+c.__rrid__):o=c,a=null===c||"undefined"==typeof c?"undefined":u,e[t][o]=e[t][o]?e[t][o]:{},e[t][o][a]=e[t][o][a]?e[t][o][a]:{},e[t][o][a][n.__rrid__]=n})}function s(e,n,t,i){if("undefined"!=typeof n[t]||e[t]){e[t]=e[t]?e[t]:{};var o,a,c,u,s=n[t],f=typeof s,l=typeof i;"object"===f&&s?("undefined"==typeof s.__rrid__&&Object.defineProperty(s,"__rrid__",{value:r.v4()}),c=s.constructor.name+"@"+s.__rrid__):c=s,u=null===s||"undefined"==typeof s?"undefined":f,o="object"===l&&i?i.constructor.name+"@"+i.__rrid__:i,u=null===s||"undefined"==typeof s?"undefined":f,a=null===i||"undefined"==typeof i?"undefined":l,e[t][c]=e[t][c]?e[t][c]:{},e[t][c][u]=e[t][c][u]?e[t][c][u]:{},e[t][c][u][n.__rrid__]=n,e[t][o]&&e[t][o][a]&&delete e[t][o][a][n.__rrid__]}}function f(e,n,t,r){if(!e)return!1;var i,o,a=!1;return n instanceof Number||n instanceof String||n instanceof Boolean||["number","string","boolean"].indexOf(typeof n)>=0?(i=["value"],a=!0):i=Object.keys(n),t=t?t:[],r=r?r:[],i.every(function(i){if(!a&&!e[i])return!1;var c,u,s=a?n.valueOf():n[i],l=typeof s;if("object"===l&&s){if(t.indexOf(i)>=0&&t.indexOf(i)===r.indexOf(s))return!0;var d=Object.keys(e[i]);return d.some(function(e){var n=e.split("@");if(2!==n.length)return!1;var o=Function("return "+n[0])();return"function"==typeof o&&o.index?(t.push(i),r.push(s),f(o.index,s,t,r)):!1})}return c=s,u=null===s||"undefined"==typeof s?"undefined":l,e[i][c]&&e[i][c][u]?n.__rrid__&&!e[i][c][u][n.__rrid__]?!1:(o=o?p(o,Object.keys(e[i][c][u])):Object.keys(e[i][c][u]),o.length>0):!1})}function l(e,n,t,r){if(!e)return!1;var i=!1;return(n instanceof Number||n instanceof String||n instanceof Boolean||["number","string","boolean"].indexOf(typeof n)>=0)&&(i=!0),t=t?t:[],r=r?r:[],Object.keys(e).some(function(o){var a=i?n.valueOf():n[o],c=typeof a;if(!i&&"undefined"==typeof n[o])return!1;if("object"===c&&a){if(t.indexOf(o)>=0&&t.indexOf(o)===r.indexOf(a))return!0;var u=Object.keys(e[o]);return u.some(function(e){var n=e.split("@");if(2!==n.length)return!1;var i=Function("return "+n[0])();return"function"==typeof i&&i.index?(t.push(o),r.push(a),l(i.index,a,t,r)):!1})}return Object.keys(e[o]).some(function(n){return n!==a+""?!0:Object.keys(e[o][n]).some(function(e){return e!==c?!0:void 0})})})}function d(e,n){this.boost=n,this.rules={},this.triggerlessRules={},this.data=new Map,this.agenda=[],this.run.assertions=0,this.run.modifications=0,this.run.executions=0,this.domain=e?e:{}}var p=e(!1);n.prototype.length=function(){var e=this;if(0===e.collections.length)return 0;var n=1;return this.collections.forEach(function(e){n*=e.length}),"number"==typeof e.start?"number"==typeof e.end?e.end-e.start:n-e.start:n},n.prototype.length.size=n.prototype.length,n.prototype.every=function(e,n){function t(e,n,r,i,o,a,c,u){var s=i[n],f=i.length-1,l=o[n];if(n===f)for(var d=0;l>d;++d){if(a[n]=s[d],!c(a.slice(0),r.count))return!1;r.count++}else for(var p=0;l>p;++p)a[n]=s[p],t(e,n+1,r,i,o,a,c,u);a.pop()}if("number"==typeof start)return this.some2(e,n);for(var r=this,i=[],o=[],a=r.collections.length;a--;)o[a]=r.collections[a].length;return t(r,0,{count:0},r.collections,o,i,e,n)!==!1?!0:void 0},n.prototype.get=function(e,n){function t(e,n,t,r){for(var i=n.length;i--;)r[i]=n[i][(e/t[i][0]<<0)%t[i][1]]}for(var r,i=this,o=[],a=[],c=1,u=i.collections.length;u--;c*=r)o[u]=[c,r=i.collections[u].length];return e>=i.length()?void 0:(t(e,i.collections,o,a),!n||n.every(function(e,n){return"undefined"==typeof e||("function"==typeof e?e.call(a,a[n],n):!1)||a[n]===e})?a.slice(0):void 0)},n.prototype.some=function(e,n){function t(e,n,r,i,o,a,c,u){var s=i[n],f=i.length-1,l=o[n];if(n===f)for(var d=0;l>d;++d){if(a[n]=s[d],c(a.slice(0),r.count))return!0;r.count++}else for(var p=0;l>p;++p)a[n]=s[p],t(e,n+1,r,i,o,a,c,u);a.pop()}if("number"==typeof start)return this.some2(e,n);for(var r=this,i=[],o=[],a=r.collections.length;a--;)o[a]=r.collections[a].length;return t(r,0,{count:0},r.collections,o,i,e,n)},n.prototype.some2=function(e,n){var t,r=this,i=0,o=r.length();do{if(t=r.get(i),"undefined"!=typeof t&&(!e||e(t))&&(!n||r.testpattern(n,t)))return!0;i++}while(o>i);return!1},n.prototype.verify=function(e,n){var t=this,r=t.get(e);return r&&r.every(function(e,t){return e===n[t]})},n.prototype.forEach1=function(e){function n(e,t,r,i,o,a,c){var u=i[t],s=i.length-1,f=o[t];if(t===s)for(var l=0;f>l;++l)a[t]=u[l],c(a.slice(0),r.count),r.count++;else for(var d=0;f>d;++d)a[t]=u[d],n(e,t+1,r,i,o,a,c);a.pop()}if("number"==typeof start)return void this.forEach2(e);for(var t=this,r=[],i=[],o=t.collections.length;o--;)i[o]=t.collections[o].length;n(t,0,{count:0},t.collections,i,r,e)},n.prototype.forEach2=function(e){for(var n=this,t="number"==typeof n.start?n.start:0,r="number"==typeof n.end?n.end:n.length();r>t;){var i=n.get(t);"undefined"!=typeof i&&e(i),t++}},n.prototype.forEach=n.prototype.forEach1;var v={};v.log=function(){var e=console;e.log.apply(console,arguments)},a.prototype.cancel=function(){this.cancelled=!0},a.prototype.execute=function(e){var n=this;n["delete"](void 0,e,!0),n.cancelled||n.bindings&&!n.bindings.verify(n.index,n.match)||!n.rule.compiledConditions.every(function(e){return e.call(n,n.match)})||n.rule.fire(n.match)},a.prototype["delete"]=function(e,n,t){var r,i=this;if(!e||i.match.indexOf(e)>=0){!t&&i.rule.reactor.tracelevel>1&&v.log("Deactivating: ",i.rule,i.match);var o=i.rule.activations.get(e);if(o&&(r=o.indexOf(i),r>=0&&(o.splice(r,1),0===o.length&&i.rule.activations["delete"](e))),"undefined"!=typeof n)return n===i.rule.reactor.agenda.length-1?void i.rule.reactor.agenda.pop():void i.rule.reactor.agenda.splice(n,1);r=i.rule.reactor.agenda.indexOf(i),r>=0&&i.rule.reactor.agenda.splice(r,1)}},c.prototype.bind=function(e,n){var t=this,r=Object.keys(t.bindings);return r.map(function(n){e instanceof t.domain[n]&&-1===t.bindings[n].indexOf(e)&&(t.reactor.tracelevel>2&&v.log("Binding: ",t,n,e),t.bindings[n].push(e))}),n?t.test(e):void 0},c.prototype.bindInstances=function(e){var n=this,t=Object.keys(n.domain);t.forEach(function(t){n.domain[t].instances.forEach(function(t){n.bind(t,e)})})},c.prototype["delete"]=function(){var e=this,n=Object.keys(e.domain);n.forEach(function(n){var t=e.domain[n];delete t.prototype.rules[e.name]})},c.prototype.fire=function(e){var n=this;n.reactor.tracelevel>0&&v.log("Firing: ",this,e),this.fired++,this.reactor.run.executions++,this.compiledAction(e)},c.prototype.test=function(e,t){var r=this,i=Object.keys(r.domain),o=!1,c=[];if(!i.every(function(e){return c.push(r.bindings[e]),r.bindings[e].length>0}))return r.cxproduct=null,!1;r.cxproduct||(r.cxproduct=new n(c)),r.reactor.tracelevel>2&&v.log("Testing: ",r,e,t),r.tested++;var u=function(n,t){return r.compiledConditions.every(function(e){return e.call(r,n)})?(new a(r,n,t,r.cxproduct,e),o=!0,!0):void 0};return 0===i.length?u()?o=!0:(r.reset(e),o=!1):(r.potentialMatches=Math.max(r.potentialMatches,r.cxproduct.length()),e?i.forEach(function(t,i){var c=r.cxproduct.collections.slice(0);if(e instanceof r.domain[t]){c[i]=[e];var s=new n(c);u=function(n,t){r.compiledConditions.every(function(e){return e.call(r,n)})&&(new a(r,n,t,s,e),o=!0)},s.forEach(u)}}):r.cxproduct.forEach(u)),o},c.prototype.reset=function(e){var n=this;n.reactor.tracelevel>2&&v.log("Reseting: ",n,e),n.activations.forEach(function(t,r){e&&r!==e||t.forEach(function(e){var t=n.reactor.agenda.indexOf(e);t>=0&&n.reactor.agenda.splice(t,1)})})},c.prototype.unbind=function(e){var n=this,t=Object.keys(n.bindings);t.map(function(t){if(e instanceof n.domain[t]){var r=n.bindings[t].indexOf(e);r>=0&&(n.reactor.tracelevel>2&&v.log("Unbinding: ",n,t,e),n.bindings[t].splice(r,1),0===n.bindings[t].length&&(n.cxproduct=null),n.reset(e))}})},d.prototype.assert=function(e,n){var t=this;e=Array.isArray(e)||e instanceof Array?e:[e];var i=[];e.forEach(function(e){if(e&&"object"==typeof e){if("undefined"==typeof e.__rrid__&&Object.defineProperty(e,"__rrid__",{value:r.v4()}),t.data.has(e.__rrid))return;t.tracelevel>2&&v.log("Assert: ",e),t.run.assertions++,t.data.set(e.__rrid__,e),t.dataModified=!0,i.push(e),e.constructor.instances=e.constructor.instances?e.constructor.instances:[],e.constructor.instances.push(e),e.constructor.index=e.constructor.index?e.constructor.index:{},u(e.constructor.index,e);var n=Object.keys(e);e.activeKeys&&Object.keys(e.activeKeys).forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n.forEach(function(n){function r(){return r.value}function i(i){if(r.value!==i){t.tracelevel>2&&v.log("Modify: ",e,n,r.value,"=>",i);var o=r.value;return r.value=i,s(e.constructor.index,e,n,o),t.dataModified=!0,t.run.modifications++,i&&i.rules&&t.assert(i),e.rules&&Object.keys(e.rules).forEach(function(t){var r=e.rules[t];if(r.triggers.some(function(t){return Object.keys(t.range).some(function(r){return t.range[r][n]&&e instanceof t.domain[r]})})){var i=r.activations.get(e);i&&i.forEach(function(e){e.cancel()}),r.test(e,n)}}),r.value}}var o,a=Object.getOwnPropertyDescriptor(e,n);if(a&&(o={},Object.keys(a).forEach(function(e){o[e]=a[e]})),a=a?a:{enumerable:!0,configurable:!1},!a.get||"rrget"!==a.get.name){if(r.value=a.value,r.originalDescriptor=o,a.value instanceof Array||Array.isArray(a.value)){var c=a.value;o.value=c.slice();var u=["push","pop","splice","shift","unshift"];u.forEach(function(i){var o=c[i];if("function"==typeof o){var a=function(){o.apply(c,arguments),t.run.modifications++,Object.keys(e.rules).forEach(function(t){var r=e.rules[t];if(r.triggers.some(function(t){return Object.keys(t.range).some(function(r){return t.range[r][n]&&e instanceof t.domain[r]})})){var i=r.activations.get(e);i&&i.forEach(function(e){e.cancel()}),r.test(e,n)}})};Object.defineProperty(r.value,i,{configurable:!0,writable:!0,value:a})}}),Object.getOwnPropertyNames(Array.prototype).forEach(function(e){var n=c[e];"function"==typeof n&&-1===u.indexOf(e)&&Object.defineProperty(r.value,e,{configurable:!0,writable:!0,value:function(){return n.apply(c,arguments)}})})}delete a.value,delete a.writable,a.get=r,a.set=i,Object.defineProperty(e,n,a)}})}}),i.forEach(function(e){e.rules&&Object.keys(e.rules).forEach(function(n){e.rules[n].bind(e)})}),i.forEach(function(e){e.rules&&Object.keys(e.rules).forEach(function(n){var t=e.rules[n];t.test(e)})}),n&&n(null)},d.prototype.createRule=function(e,n,t,r,i){var o=this,a=new c(this,e,n,t,r,i,o.boost);return o.rules[a.name]=a,0===a.triggers.length&&(o.triggerlessRules[a.name]=a),a},d.forAll=function(e,r){if("object"!=typeof e)throw new TypeError("Domain "+e+" is not an object in universal quantification");var i=Object.keys(e);if("object"==typeof r){if(!r)throw new TypeError("Universal quantification condition is null");return Object.keys(r).every(function(n){var t=i.indexOf(n);if(-1===t)throw new ReferenceError("Undeclared domain variable '"+n+"' in existential quantification match condition");return!l(e[n].index,r[n])})}if(-1===(r+"").indexOf("return "))throw new TypeError("Universal quantification condition function missing a return statement: "+r);if(!r.cxproduct){var o,a=[];i.forEach(function(n){e[n].instances=e[n].instances?e[n].instances:[],a.push(e[n].instances)}),r.cxproduct=new n(a),o=t(r),o.length>0&&(r.required=o.map(function(e){var n=i.indexOf(e);if(-1===n)throw new ReferenceError("Undeclared domain variable '"+e+"' in universal quantification condition function");return n}))}return r.cxproduct.every(function(e){var n=[];return!r.required||r.required.every(function(t){return n.push(e[t]),"undefined"!=typeof e[t]})?r.apply(null,n):void 0})},d.prototype.forAll=d.forAll,d.exists=function(e,r){if("object"!=typeof e)throw new TypeError("Domain "+e+" is not an object in existential quantification");var i=Object.keys(e);if("object"==typeof r){if(!r)throw new TypeError("Existential quantification condition is null");return Object.keys(r).every(function(n){var t=i.indexOf(n);if(-1===t)throw new ReferenceError("Undeclared domain variable '"+n+"' in existential quantification match condition");return f(e[n].index,r[n])})}if(-1===(r+"").indexOf("return "))throw new TypeError("Existential quantification condition function missing a return statement: "+r);if(!r.cxproduct){var o,a=[];i.forEach(function(n){e[n].instances=e[n].instances?e[n].instances:[],a.push(e[n].instances)}),r.cxproduct=new n(a),o=t(r),o.length>0&&(r.required=o.map(function(e){var n=i.indexOf(e);if(-1===n)throw new ReferenceError("Undeclared domain variable '"+e+"' in existential quantification condition function");return n}))}return r.cxproduct.some(function(e){var n=[];return!r.required||r.required.every(function(t){return n.push(e[t]),"undefined"!=typeof e[t]})?r.apply(null,n):void 0})},d.prototype.exists=d.exists,d.not=function(e){return!e},d.prototype.not=d.not,d.prototype.retract=function(e,n){var t=this;e=Array.isArray(e)||e instanceof Array?e:[e],e.forEach(function(e){e&&"object"==typeof e&&(t.tracelevel>2&&v.log("Retract: ",e),t.data["delete"](e.__rrid__),t.dataModified=!0,Object.keys(e).forEach(function(n){var t=Object.getOwnPropertyDescriptor(e,n);if(t.get&&"rrget"===t.get.name)if("undefined"==typeof t.get.originalDescriptor)delete e[n];else{if(t.get.originalDescriptor.value instanceof Array||Array.isArray(t.get.originalDescriptor.value))if(e[n]instanceof Array||Array.isArray(e[n])){var r=[0,e[n]].concat(t.get.originalDescriptor.value);e[n].splice.apply(e[n],r)}else e[n]=t.get.originalDescriptor.value;Object.defineProperty(e,n,t.get.originalDescriptor)}}),Object.keys(e.rules).forEach(function(n){e.rules[n].unbind(e)}))}),n&&setTimeout(function(){t.run()})},d.prototype.reset=function(e){var n=this;if(Object.keys(n.rules).forEach(function(e){n.rules[e].reset()}),e){var t=[];n.data.forEach(function(e){t.push(e)}),n.retract(t,!1)}n.run.running=!1},d.prototype.run=function(e,n,t){function r(){if(i.run.stop)return i.tracelevel>0&&(v.log("Data Count: ",i.data.size),v.log("Executions: ",i.run.executions),v.log("RPS: ",i.run.rps)),i.tracelevel>1&&Object.keys(i.rules).forEach(function(e){var n=i.rules[e];v.log(n.name,n.potentialMatches,n.tested,n.activated,n.fired)}),void("function"==typeof t&&t());if(i.run.executions<i.run.max)for(Object.keys(i.triggerlessRules).forEach(function(e){var n=i.triggerlessRules[e],t=n.activations.get();t&&0!==t.length||n.test()});i.agenda.length>0&&(i.dataModified=!1,i.agenda[i.agenda.length-1].execute(i.agenda.length-1),!i.dataModified););setTimeout(r,0)}var i=this;return i.run.running?!0:(i.run.max=e?e:1/0,i.run.running=!0,i.run.executions=0,i.run.assertions=0,i.run.modifications=0,i.run.start=new Date,i.run.stop=null,i.tracelevel>0&&v.log("Run: ",e),void setTimeout(r,0))},d.prototype.stop=function(){this.run.stop=new Date,this.run.rps=this.run.executions/(this.run.stop.getTime()-this.run.start.getTime())*1e3,this.run.running=!1},d.prototype.trace=function(e){this.tracelevel=e,this.processor&&(e>3?this.processor.trace(1):this.processor.trace(0))},this.exports?this.exports=d:"function"==typeof define&&define.amd?define(function(){return d}):this.RuleReactor=d}).call("undefined"!=typeof window?window:"undefined"!=typeof n?n:null)},{uuid:3}],2:[function(e,n,t){(function(e){var t;if(e.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);t=function(){return crypto.getRandomValues(r),r}}if(!t){var i=new Array(16);t=function(){for(var e,n=0;16>n;n++)0===(3&n)&&(e=4294967296*Math.random()),i[n]=e>>>((3&n)<<3)&255;return i}}n.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n,t){function r(e,n,t){var r=n&&t||0,i=0;for(n=n||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>i&&(n[r+i++]=s[e])});16>i;)n[r+i++]=0;return n}function i(e,n){var t=n||0,r=u;return r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]}function o(e,n,t){var r=n&&t||0,o=n||[];e=e||{};var a=void 0!==e.clockseq?e.clockseq:p,c=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:y+1,s=c-v+(u-y)/1e4;if(0>s&&void 0===e.clockseq&&(a=a+1&16383),(0>s||c>v)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=c,y=u,p=a,c+=122192928e5;var f=(1e4*(268435455&c)+u)%4294967296;o[r++]=f>>>24&255,o[r++]=f>>>16&255,o[r++]=f>>>8&255,o[r++]=255&f;var l=c/4294967296*1e4&268435455;o[r++]=l>>>8&255,o[r++]=255&l,o[r++]=l>>>24&15|16,o[r++]=l>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var h=e.node||d,g=0;6>g;g++)o[r+g]=h[g];return n?n:i(o)}function a(e,n,t){var r=n&&t||0;"string"==typeof e&&(n="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||c)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n)for(var a=0;16>a;a++)n[r+a]=o[a];return n||i(o)}for(var c=e("./rng"),u=[],s={},f=0;256>f;f++)u[f]=(f+256).toString(16).substr(1),s[u[f]]=f;var l=c(),d=[1|l[0],l[1],l[2],l[3],l[4],l[5]],p=16383&(l[6]<<8|l[7]),v=0,y=0,h=a;h.v1=o,h.v4=a,h.parse=r,h.unparse=i,n.exports=h},{"./rng":2}]},{},[1]);
